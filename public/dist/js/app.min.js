var app=angular.module("app",["ngRoute","ngResource"]);app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"/template/users.html",controller:"UserController"}).when("/:id",{templateUrl:"/template/userDetails.html",controller:"UserDetailController"})}]),app.controller("UserController",["$scope","Users",function(a,b){a.validationError=null,a.editing=[],a.users=b.query(),a.save=function(){if(a.newUsername&&!(a.newUsername.length<1)){var c=new b({username:a.newUsername,email:a.newUsername+"@test.com",password:"123456",is_actived:!1});c.$save(function(){return"undefined"!=typeof c.errors?void(a.validationError=c.errors):(a.users.push(c),a.newUsername="",void(a.validationError=null))})}},a.update=function(c,d){var e={},f=a.users[c],g=a.editing[c];if("is_actived"===d)e.is_actived=f.is_actived;else if("username"===d&&(e.username=f.username,f.username===g.username))return void a.cancel(c);b.update({id:f._id},e,function(b){return"undefined"!=typeof b.errors?void(a.validationError=b.errors):(a.editing[c]=!1,void(a.validationError=null))})},a.edit=function(b){a.editing[b]=angular.copy(a.users[b])},a.cancel=function(b){a.users[b]=angular.copy(a.editing[b]),a.editing[b]=!1},a.remove=function(c){var d=a.users[c];b.remove({id:d._id},function(){a.users.splice(c,1)})}}]),app.controller("UserDetailController",["$scope","$routeParams","Users","$location",function(a,b,c,d){a.user=c.get({id:b.id}),a.update=function(){var e={};e.is_actived=a.user.is_actived,c.get({id:b.id},function(b){b.email!==a.user.email&&(e.email=a.user.email),c.update({id:a.user._id},e,function(b){return"undefined"!=typeof b.errors?void(a.validationError=b.errors):void d.url("/")})})},a.remove=function(){c.remove({id:a.user._id},function(){d.url("/")})}}]),app.factory("Users",["$resource",function(a){return a("/users/:id",null,{update:{method:"PUT"}})}]);